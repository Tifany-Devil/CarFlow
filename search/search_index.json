{"config":{"lang":["pt"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"CarFlow \u2014 Documenta\u00e7\u00e3o T\u00e9cnica","text":"<p>Projeto individual Streamlit PostgreSQL SQLAlchemy Batch mensal</p> <p>O CarFlow \u00e9 um sistema de captura e consulta p\u00fablica de pre\u00e7os de ve\u00edculos (refer\u00eancia tipo FIPE), com processamento mensal para consolida\u00e7\u00e3o de m\u00e9dias e disponibiliza\u00e7\u00e3o r\u00e1pida para consulta.</p> \u2705 Escopo do que ser\u00e1 implementado (build) <ul> <li>Consulta p\u00fablica (sem login) com filtros em cascata: Marca \u2192 Modelo \u2192 Ano-modelo</li> <li>Batch mensal para consolidar m\u00e9dias em tabela otimizada para leitura</li> <li>Log de consultas (<code>query_logs</code>) sem dados pessoais, para an\u00e1lise posterior</li> </ul> \ud83d\udce6 Entreg\u00e1veis de engenharia <ul> <li>Cat\u00e1logo de requisitos: atores, permiss\u00f5es, user stories e regras de neg\u00f3cio</li> <li>BPMN do processo completo (cadastros \u2192 roteiro \u2192 coleta \u2192 aprova\u00e7\u00e3o)</li> <li>Modelagem de dados (ERD + dicion\u00e1rio)</li> <li>Arquitetura (C4) e Technical Design (componentes + sequ\u00eancias)</li> <li>Testes automatizados e pipeline de CI</li> </ul> \ud83d\ude80 Pr\u00f3ximos passos <ol> <li>Documentar Arquitetura (C4) (Contexto + Containers + Componentes)</li> <li>Documentar Technical Design (camadas, sequ\u00eancias e decis\u00f5es)</li> <li>Fechar Qualidade (estrat\u00e9gia de testes + CI)</li> </ol>"},{"location":"01-visao-geral/escopo/","title":"Escopo (IN/OUT)","text":"<p>Este documento define o escopo do CarFlow para esta entrega, separando claramente: - o que ser\u00e1 implementado (build), e - o que ser\u00e1 apenas documentado (spec-only).</p> <p>Objetivo: evitar \u201cscope creep\u201d e deixar rastre\u00e1vel o que entrou/saiu da vers\u00e3o.</p>"},{"location":"01-visao-geral/escopo/#visao-geral-do-sistema","title":"Vis\u00e3o Geral do Sistema","text":"<p>O CarFlow \u00e9 um sistema de captura e consulta p\u00fablica de pre\u00e7os de ve\u00edculos (refer\u00eancia tipo FIPE), com processamento mensal para consolida\u00e7\u00e3o de m\u00e9dias e disponibiliza\u00e7\u00e3o r\u00e1pida para consulta.</p>"},{"location":"01-visao-geral/escopo/#premissas-do-build","title":"Premissas do build","text":"<ul> <li>Sem login na consulta p\u00fablica.</li> <li>Banco PostgreSQL com acesso via SQLAlchemy.</li> <li>Batch mensal consolidando dados aprovados para leitura r\u00e1pida.</li> <li>Logs de consulta sem dados pessoais.</li> </ul>"},{"location":"01-visao-geral/escopo/#escopo-implementado-build","title":"Escopo Implementado (BUILD)","text":""},{"location":"01-visao-geral/escopo/#1-consulta-publica-streamlit","title":"1) Consulta p\u00fablica (Streamlit)","text":"<p>Objetivo: permitir ao usu\u00e1rio consultar o pre\u00e7o consolidado.</p> <p>Fluxo: 1. Seleciona Marca 2. Seleciona Modelo 3. Seleciona Ano-modelo 4. O sistema retorna:    - pre\u00e7o consolidado    - m\u00eas de refer\u00eancia (<code>month_ref</code>)</p> <p>Regras (build): - Consulta l\u00ea somente <code>monthly_averages</code>. - Toda consulta registra um evento em <code>query_logs</code>:   - <code>SUCCESS</code> quando encontra resultado   - <code>NO_RESULT</code> quando n\u00e3o encontra   - <code>ERROR</code> se ocorrer falha</p>"},{"location":"01-visao-geral/escopo/#2-batch-mensal-de-consolidacao","title":"2) Batch mensal de consolida\u00e7\u00e3o","text":"<p>Objetivo: consolidar coletas aprovadas em uma tabela otimizada para leitura.</p> <p>Entrada: <code>price_collections</code> Sa\u00edda: <code>monthly_averages</code></p> <p>Regras (build): - Usar apenas coletas com <code>approval_status = APPROVED</code>. - Agrupar por:   - <code>brand_id</code>, <code>model_id</code>, <code>year_model</code>, <code>month_ref</code> - Gerar:   - <code>avg_price</code> (obrigat\u00f3rio)   - m\u00e9tricas opcionais (se voc\u00ea decidir manter): <code>median_price</code>, <code>std_dev</code>, <code>samples_count</code></p>"},{"location":"01-visao-geral/escopo/#3-armazenamento-e-estrutura-minima-de-dados","title":"3) Armazenamento e estrutura m\u00ednima de dados","text":"<p>Tabelas do build: - <code>brands</code> e <code>models</code> (cat\u00e1logo) - <code>stores</code> (origem/simula\u00e7\u00e3o) - <code>price_collections</code> (coletas brutas) - <code>monthly_averages</code> (consolidado para consulta) - <code>query_logs</code> (auditoria t\u00e9cnica)</p> <p>Observa\u00e7\u00e3o: <code>stores</code> e <code>price_collections</code> podem ser alimentadas por seed/dados simulados nesta vers\u00e3o.</p>"},{"location":"01-visao-geral/escopo/#escopo-documentado-spec-only","title":"Escopo Documentado (SPEC-ONLY)","text":"<p>Nesta entrega, o processo completo \u00e9 documentado, mas n\u00e3o implementado (build) em UI/CRUD.</p>"},{"location":"01-visao-geral/escopo/#papeis-operacionais-nao-implementados","title":"Pap\u00e9is operacionais (n\u00e3o implementados)","text":"<ul> <li>Coordenador (planejamento/valida\u00e7\u00e3o)</li> <li>Pesquisador (coleta)</li> <li>Admin/Gerente/Lojista (cadastros e governan\u00e7a)</li> </ul>"},{"location":"01-visao-geral/escopo/#funcionalidades-spec-only","title":"Funcionalidades spec-only","text":"<ul> <li>CRUD de usu\u00e1rios e autentica\u00e7\u00e3o</li> <li>CRUD completo de lojas/rotas/roteiros</li> <li>UI de aprova\u00e7\u00e3o (aprovar/rejeitar coletas)</li> <li>Gest\u00e3o regional e atribui\u00e7\u00e3o de pesquisadores</li> <li>Pain\u00e9is operacionais (m\u00e9tricas, produtividade, pend\u00eancias)</li> <li>Auditoria avan\u00e7ada (trilhas completas, relat\u00f3rios)</li> </ul>"},{"location":"01-visao-geral/escopo/#fora-do-escopo-out","title":"Fora do Escopo (OUT)","text":"<p>Itens explicitamente fora desta vers\u00e3o: - Autentica\u00e7\u00e3o/autoriza\u00e7\u00e3o (login e perfis) - Cadastros operacionais completos (usu\u00e1rios, roteiros, permiss\u00f5es) - Coleta mobile/field app - Integra\u00e7\u00f5es externas (FIPE oficial, ETL completo, mensageria) - LGPD avan\u00e7ado (base legal, consentimento, minimiza\u00e7\u00e3o formal completa) - Observabilidade completa (tracing, dashboards, alertas)</p>"},{"location":"01-visao-geral/escopo/#criterios-de-pronto-dod-da-entrega","title":"Crit\u00e9rios de Pronto (DoD) da entrega","text":"<p>Consideramos esta entrega pronta quando: - A consulta p\u00fablica funciona de ponta a ponta usando <code>monthly_averages</code>. - O batch mensal gera/atualiza <code>monthly_averages</code> a partir de <code>price_collections</code> APPROVED. - Toda consulta gera um registro em <code>query_logs</code> (sem dados pessoais). - A documenta\u00e7\u00e3o apresenta:   - processo (BPMN + fluxos)   - ERD + dicion\u00e1rio   - arquitetura e technical design (m\u00ednimo)   - qualidade (testes + CI)</p>"},{"location":"01-visao-geral/escopo/#referencias-internas-da-documentacao","title":"Refer\u00eancias internas da documenta\u00e7\u00e3o","text":"<ul> <li>Processos: <code>03-processos-bpmn/</code></li> <li>Modelagem de dados: <code>04-modelagem-dados/</code></li> <li>Arquitetura (C4): <code>05-arquitetura/</code></li> <li>Technical Design: <code>06-technical-design/</code></li> <li>Qualidade: <code>07-qualidade/</code></li> </ul>"},{"location":"02-requisitos/","title":"Requisitos","text":""},{"location":"02-requisitos/#objetivo","title":"Objetivo","text":"<p>O CarFlow \u00e9 um sistema de captura e consulta de pre\u00e7os de ve\u00edculos (tipo FIPE). A solu\u00e7\u00e3o contempla o processo completo (cadastros, roteiros, coleta e aprova\u00e7\u00e3o), por\u00e9m a implementa\u00e7\u00e3o (build) foca em: - Consulta P\u00fablica (sem login) - Batch mensal de consolida\u00e7\u00e3o de m\u00e9dias - Registro de log de consultas (sem dados pessoais)</p>"},{"location":"02-requisitos/#atores-e-papeis","title":"Atores e pap\u00e9is","text":""},{"location":"02-requisitos/#papeis-do-sistema-visao-completa","title":"Pap\u00e9is do sistema (vis\u00e3o completa)","text":"<ul> <li>Administrador: gerencia usu\u00e1rios e perfis</li> <li>Gerente: gerencia dados globais (marcas/modelos e demais cadastros globais)</li> <li>Coordenador: define roteiro semanal e aprova coletas/lojas na sua regi\u00e3o</li> <li>Pesquisador: realiza coleta em lojas e pode sugerir novas lojas</li> <li>Lojista: solicita cadastro da pr\u00f3pria loja</li> <li>Usu\u00e1rio P\u00fablico: consulta pre\u00e7o m\u00e9dio consolidado (sem login)</li> <li>Sistema (Batch): processa coletas aprovadas e consolida m\u00e9dias mensais</li> </ul>"},{"location":"02-requisitos/#matriz-de-permissoes-resumo","title":"Matriz de permiss\u00f5es (resumo)","text":"Papel A\u00e7\u00f5es principais Implementa\u00e7\u00e3o Administrador Cadastrar/editar/inativar usu\u00e1rios Spec-only Gerente Gerenciar marcas/modelos e dados globais Spec-only Coordenador Definir roteiro semanal, aprovar coletas e lojas Spec-only Pesquisador Registrar coletas, sugerir lojas Spec-only Lojista Solicitar cadastro de loja Spec-only Usu\u00e1rio P\u00fablico Consultar pre\u00e7os consolidados (marca\u2192modelo\u2192ano) Build Sistema (Batch) Consolidar m\u00e9dias mensais Build <p>Observa\u00e7\u00e3o: pap\u00e9is Spec-only ser\u00e3o detalhados por fluxos/diagramas e wireframes, mas n\u00e3o ser\u00e3o implementados como telas/CRUD completos.</p>"},{"location":"02-requisitos/#regras-de-negocio-versao-1","title":"Regras de neg\u00f3cio (vers\u00e3o 1)","text":""},{"location":"02-requisitos/#consulta-publica-us07","title":"Consulta p\u00fablica (US07)","text":"<ul> <li>A consulta deve permitir filtros em cascata: Marca \u2192 Modelo \u2192 Ano-modelo.</li> <li>O resultado deve exibir valor consolidado e m\u00eas de refer\u00eancia.</li> <li>A consulta n\u00e3o exige login.</li> <li>O sistema deve armazenar o log de consulta para an\u00e1lise posterior, sem dados pessoais.</li> </ul>"},{"location":"02-requisitos/#consolidacao-mensal-us08","title":"Consolida\u00e7\u00e3o mensal (US08)","text":"<ul> <li>O batch considera coletas aprovadas dentro do per\u00edodo mensal.</li> <li>Consolida valores por: (marca, modelo, ano-modelo, m\u00eas de refer\u00eancia).</li> <li>Gera tabela otimizada para leitura na consulta p\u00fablica (ex.: <code>monthly_averages</code>).</li> <li>Tratamento de outliers: definido na se\u00e7\u00e3o de Technical Design (inicialmente pode ser simples e documentado).</li> </ul>"},{"location":"02-requisitos/#user-stories-catalogo","title":"User Stories (cat\u00e1logo)","text":""},{"location":"02-requisitos/#spec-only-nao-implementadas","title":"Spec-only (n\u00e3o implementadas)","text":"<ul> <li>US01 \u2014 Administrador: Gest\u00e3o de usu\u00e1rios (cadastrar/editar/inativar)</li> <li>US02 \u2014 Gerente: Gest\u00e3o de marcas/modelos e dados globais</li> <li>US03-A \u2014 Lojista: Solicitar cadastro de loja</li> <li>US03-B \u2014 Coordenador: Aprovar solicita\u00e7\u00f5es de lojas</li> <li>US04 \u2014 Coordenador: Defini\u00e7\u00e3o de roteiro semanal por regi\u00e3o</li> <li>US05 \u2014 Pesquisador: Coleta de pre\u00e7os em loja</li> <li>US06 \u2014 Coordenador: Valida\u00e7\u00e3o/aprova\u00e7\u00e3o de coletas</li> <li>US09 \u2014 Pesquisador: Sugest\u00e3o de nova loja</li> </ul>"},{"location":"02-requisitos/#build-implementadas","title":"Build (implementadas)","text":"<ul> <li>US07 \u2014 Usu\u00e1rio p\u00fablico: Consulta de pre\u00e7os consolidados (sem login)</li> <li>US08 \u2014 Sistema: Batch mensal de c\u00e1lculo e consolida\u00e7\u00e3o de m\u00e9dias</li> </ul>"},{"location":"02-requisitos/#requisitos-nao-funcionais-nfr-minimo","title":"Requisitos n\u00e3o-funcionais (NFR) \u2013 m\u00ednimo","text":"<ul> <li>Rastreabilidade: artefatos (BPMN/ERD/C4/TD) versionados no reposit\u00f3rio e referenciados na documenta\u00e7\u00e3o.</li> <li>Observabilidade: registrar logs de consulta (sem dados pessoais).</li> <li>Reprodutibilidade: ambiente local via Docker Compose.</li> <li>Qualidade: testes automatizados para l\u00f3gica do batch e pipeline de CI.</li> </ul>"},{"location":"03-processos-bpmn/","title":"Processos (BPMN)","text":"<p>Esta se\u00e7\u00e3o descreve o processo de neg\u00f3cio completo do CarFlow (vis\u00e3o end-to-end), mapeando o ciclo de vida da informa\u00e7\u00e3o desde o planejamento da visita at\u00e9 a consolida\u00e7\u00e3o do pre\u00e7o m\u00e9dio.</p> <p>O escopo inclui pap\u00e9is spec-only (documentados para contexto) e as partes build (Consulta p\u00fablica + Batch).</p>"},{"location":"03-processos-bpmn/#1-macrofluxo-do-processo-bpmn","title":"1. Macrofluxo do Processo (BPMN)","text":"<p>O diagrama abaixo apresenta o fluxo l\u00f3gico das atividades, decis\u00f5es e responsabilidades.</p> <p></p>"},{"location":"03-processos-bpmn/#objetivo-do-processo","title":"Objetivo do Processo","text":"<p>Garantir uma coleta estruturada de pre\u00e7os em campo, submetida a uma valida\u00e7\u00e3o de qualidade rigorosa, resultando em uma base consolidada mensalmente para consulta p\u00fablica r\u00e1pida e audit\u00e1vel.</p>"},{"location":"03-processos-bpmn/#2-atores-e-responsabilidades","title":"2. Atores e Responsabilidades","text":"Ator Tipo Responsabilidade no Processo Coordenador Humano Planejamento semanal (roteiros) e Controle de Qualidade (aprova\u00e7\u00e3o). Pesquisador Humano Execu\u00e7\u00e3o da coleta em campo (Input de dados). Sistema (Batch) Sist\u00eamico Consolida\u00e7\u00e3o massiva de dados (ETL) no dia 1\u00ba do m\u00eas. Usu\u00e1rio P\u00fablico Humano Consumo da informa\u00e7\u00e3o final (Consulta). <p>Nota: Pap\u00e9is administrativos (Admin/Gerente) e de Parceiros (Lojista) s\u00e3o considerados processos de apoio e n\u00e3o est\u00e3o detalhados neste fluxo principal.</p>"},{"location":"03-processos-bpmn/#3-descricao-do-fluxo","title":"3. Descri\u00e7\u00e3o do Fluxo","text":""},{"location":"03-processos-bpmn/#31-ciclo-semanal-operacional","title":"3.1. Ciclo Semanal (Operacional)","text":"<ol> <li>Planejamento: O Coordenador define quais lojas devem ser visitadas e atribui a tarefa ao Pesquisador.</li> <li>Coleta: O Pesquisador vai \u00e0 loja e registra os ve\u00edculos.</li> <li>Valida\u00e7\u00e3o: O Coordenador analisa as coletas pendentes:<ul> <li>Se Aprovado: O dado fica pronto para o processamento mensal.</li> <li>Se Rejeitado: O dado volta para corre\u00e7\u00e3o ou descarte.</li> </ul> </li> </ol>"},{"location":"03-processos-bpmn/#32-ciclo-mensal-sistemico","title":"3.2. Ciclo Mensal (Sist\u00eamico)","text":"<ol> <li>Consolida\u00e7\u00e3o: No fechamento do m\u00eas, o Job (Batch) processa apenas os registros aprovados.</li> <li>C\u00e1lculo: Gera-se a m\u00e9dia, mediana e desvio padr\u00e3o por modelo.</li> <li>Publica\u00e7\u00e3o: Os dados s\u00e3o gravados na tabela de leitura r\u00e1pida (<code>monthly_averages</code>).</li> </ol>"},{"location":"03-processos-bpmn/#33-ciclo-sob-demanda-consulta","title":"3.3. Ciclo Sob Demanda (Consulta)","text":"<ol> <li>Acesso: O Usu\u00e1rio P\u00fablico acessa a interface web.</li> <li>Filtro: Seleciona Marca \u2192 Modelo \u2192 Ano.</li> <li>Resultado: O sistema exibe o pre\u00e7o consolidado e registra o log da opera\u00e7\u00e3o.</li> </ol>"},{"location":"03-processos-bpmn/#4-regras-de-negocio-do-processo","title":"4. Regras de Neg\u00f3cio do Processo","text":"<ul> <li>RN01 - Qualidade do Dado: Apenas coletas com status <code>APPROVED</code> entram no c\u00e1lculo da m\u00e9dia mensal.</li> <li>RN02 - Acesso Livre: A consulta p\u00fablica n\u00e3o exige autentica\u00e7\u00e3o (login).</li> <li>RN03 - Rastreabilidade: Toda consulta p\u00fablica deve gerar um registro de auditoria t\u00e9cnica (Log), independente se houve resultado ou erro.</li> </ul>"},{"location":"03-processos-bpmn/#diagramas-complementares","title":"Diagramas complementares","text":""},{"location":"03-processos-bpmn/#swimlanes-visao-por-participante","title":"Swimlanes \u2014 vis\u00e3o por participante","text":"<p>Para detalhes de implementa\u00e7\u00e3o t\u00e9cnica:</p> <p>A modelagem das classes, diagramas de sequ\u00eancia (intera\u00e7\u00e3o entre objetos) e arquitetura de componentes est\u00e3o detalhados na se\u00e7\u00e3o Technical Design.</p>"},{"location":"04-modelagem-dados/","title":"Modelagem de Dados (ERD)","text":"<p>Esta se\u00e7\u00e3o descreve o modelo de dados do CarFlow, com foco no escopo build: - Consulta p\u00fablica (sem login) para pre\u00e7o consolidado - Batch mensal de consolida\u00e7\u00e3o de m\u00e9dias - Registro de logs das consultas (sem dados pessoais)</p> <p>A vis\u00e3o completa do processo (pap\u00e9is operacionais como pesquisador/coordenador etc.) \u00e9 documentada, por\u00e9m n\u00e3o ser\u00e1 implementada nesta vers\u00e3o.</p>"},{"location":"04-modelagem-dados/#erd-visao-geral","title":"ERD \u2014 Vis\u00e3o geral","text":""},{"location":"04-modelagem-dados/#entidades-descricao-rapida","title":"Entidades (descri\u00e7\u00e3o r\u00e1pida)","text":""},{"location":"04-modelagem-dados/#brands","title":"<code>brands</code>","text":"<p>Cat\u00e1logo de marcas (ex.: Toyota, Fiat).</p>"},{"location":"04-modelagem-dados/#models","title":"<code>models</code>","text":"<p>Cat\u00e1logo de modelos, sempre associado a uma marca. Ex.: Corolla (Toyota), Uno (Fiat).</p>"},{"location":"04-modelagem-dados/#stores","title":"<code>stores</code>","text":"<p>Cadastro de lojas (origem das coletas). Nesta vers\u00e3o, \u00e9 usado para simular a origem dos pre\u00e7os (seed).</p>"},{"location":"04-modelagem-dados/#price_collections","title":"<code>price_collections</code>","text":"<p>Tabela de coletas brutas (pre\u00e7os capturados em lojas). Representa o dado \u201coperacional\u201d que alimenta a consolida\u00e7\u00e3o mensal.</p>"},{"location":"04-modelagem-dados/#monthly_averages","title":"<code>monthly_averages</code>","text":"<p>Tabela consolidada (otimizada para leitura), usada pela consulta p\u00fablica. Cada linha representa o pre\u00e7o consolidado do m\u00eas para (marca, modelo, ano-modelo).</p>"},{"location":"04-modelagem-dados/#query_logs","title":"<code>query_logs</code>","text":"<p>Registro de logs da consulta p\u00fablica para an\u00e1lise de uso/diagn\u00f3stico. N\u00e3o armazena dados pessoais.</p>"},{"location":"04-modelagem-dados/#relacionamentos-e-cardinalidade-interpretacao","title":"Relacionamentos e cardinalidade (interpreta\u00e7\u00e3o)","text":"<ul> <li>Uma <code>brand</code> possui v\u00e1rios <code>models</code> (1:N)</li> <li>Uma <code>store</code> origina v\u00e1rias <code>price_collections</code> (1:N)</li> <li>Um <code>model</code> pode ter v\u00e1rias <code>price_collections</code> ao longo do tempo (1:N)</li> <li>Um <code>model</code> pode ter v\u00e1rias <code>monthly_averages</code> (por m\u00eas/ano-modelo) (1:N)</li> <li>Um <code>model</code> pode aparecer em v\u00e1rios <code>query_logs</code> (1:N)</li> </ul>"},{"location":"04-modelagem-dados/#integridade-referencial-fks","title":"Integridade referencial (FKs)","text":"<ul> <li><code>models.brand_id</code> \u2192 <code>brands.id</code></li> <li><code>price_collections.store_id</code> \u2192 <code>stores.id</code></li> <li><code>price_collections.brand_id</code> \u2192 <code>brands.id</code></li> <li><code>price_collections.model_id</code> \u2192 <code>models.id</code></li> <li><code>monthly_averages.brand_id</code> \u2192 <code>brands.id</code></li> <li><code>monthly_averages.model_id</code> \u2192 <code>models.id</code></li> <li><code>query_logs.brand_id</code> \u2192 <code>brands.id</code> (nullable)</li> <li><code>query_logs.model_id</code> \u2192 <code>models.id</code> (nullable)</li> </ul>"},{"location":"04-modelagem-dados/#regras-de-negocio-refletidas-no-modelo","title":"Regras de neg\u00f3cio refletidas no modelo","text":""},{"location":"04-modelagem-dados/#aprovacao-de-coletas","title":"Aprovac\u0327a\u0303o de coletas","text":"<ul> <li>Apenas registros de <code>price_collections</code> com <code>approval_status = APPROVED</code> podem ser utilizados no batch.</li> </ul>"},{"location":"04-modelagem-dados/#consulta-publica","title":"Consulta p\u00fablica","text":"<ul> <li>A consulta p\u00fablica l\u00ea apenas <code>monthly_averages</code> (n\u00e3o acessa <code>price_collections</code> diretamente).</li> <li>Toda consulta registra um evento em <code>query_logs</code>, mesmo quando n\u00e3o encontra resultado.</li> </ul>"},{"location":"04-modelagem-dados/#referencia-temporal-mes","title":"Refer\u00eancia temporal (m\u00eas)","text":"<ul> <li>O campo <code>month_ref</code> usa o formato <code>YYYY-MM</code> (ex.: <code>2026-02</code>).</li> </ul>"},{"location":"04-modelagem-dados/#restricoes-e-indices-versao-1","title":"Restri\u00e7\u00f5es e \u00edndices (vers\u00e3o 1)","text":""},{"location":"04-modelagem-dados/#unique-integridade","title":"UNIQUE (integridade)","text":"<ul> <li><code>brands.name</code></li> <li><code>models (brand_id, name)</code></li> <li><code>monthly_averages (brand_id, model_id, year_model, month_ref)</code></li> </ul> <p>Observa\u00e7\u00e3o: o <code>year_model</code> faz parte da chave l\u00f3gica de consulta, pois o usu\u00e1rio filtra por ano-modelo.</p>"},{"location":"04-modelagem-dados/#indices-perfomance","title":"\u00cdndices (perfomance)","text":"<ul> <li><code>monthly_averages (brand_id, model_id, year_model, month_ref)</code> \u2014 caminho principal da consulta p\u00fablica</li> <li><code>price_collections (approval_status, month_ref)</code> \u2014 caminho principal do batch mensal</li> <li><code>query_logs (created_at)</code> \u2014 consultas por per\u00edodo e auditoria t\u00e9cnica</li> </ul>"},{"location":"04-modelagem-dados/#check-constraints-dominios","title":"CHECK constraints (dom\u00ednios)","text":"<ul> <li><code>stores.status</code> \u2208 {<code>PENDING</code>, <code>ACTIVE</code>}</li> <li><code>price_collections.approval_status</code> \u2208 {<code>PENDING</code>, <code>APPROVED</code>, <code>REJECTED</code>}</li> <li><code>query_logs.status</code> \u2208 {<code>SUCCESS</code>, <code>NO_RESULT</code>, <code>ERROR</code>}</li> <li><code>month_ref</code> no formato <code>YYYY-MM</code> (valida\u00e7\u00e3o por aplica\u00e7\u00e3o e/ou constraint futuramente)</li> </ul>"},{"location":"04-modelagem-dados/#decisao-de-modelagem-denormalizacao-controlada","title":"Decis\u00e3o de modelagem (denormaliza\u00e7\u00e3o controlada)","text":"<p>Algumas tabelas armazenam <code>brand_id</code> junto com <code>model_id</code> para simplificar filtros e reduzir joins na consulta p\u00fablica e no batch. A consist\u00eancia \u201cmodelo pertence \u00e0 marca\u201d \u00e9 garantida pela camada de servi\u00e7o/batch. Em uma evolu\u00e7\u00e3o futura, essa regra pode ser refor\u00e7ada no banco (ex.: VIEW/trigger).</p>"},{"location":"04-modelagem-dados/#fluxo-de-dados-consulta-batch","title":"Fluxo de dados (consulta + batch)","text":"<p>A figura mostra a origem dos dados (<code>price_collections</code>), a consolida\u00e7\u00e3o mensal no batch (somente <code>APPROVED</code>), a tabela consolidada (<code>monthly_averages</code>) e o registro de auditoria de consultas (<code>query_logs</code>).</p>"},{"location":"04-modelagem-dados/#dicionario-de-dados-versao-1","title":"Dicion\u00e1rio de Dados (vers\u00e3o 1)","text":""},{"location":"04-modelagem-dados/#brands_1","title":"<code>brands</code>","text":"Campo Tipo Obrigat\u00f3rio Regras / Observa\u00e7\u00f5es id int sim PK name string sim UNIQUE created_at datetime sim timestamp de cria\u00e7\u00e3o"},{"location":"04-modelagem-dados/#models_1","title":"<code>models</code>","text":"Campo Tipo Obrigat\u00f3rio Regras / Observa\u00e7\u00f5es id int sim PK brand_id int sim FK \u2192 <code>brands.id</code> name string sim UNIQUE por marca (<code>brand_id</code>, <code>name</code>) created_at datetime sim timestamp de cria\u00e7\u00e3o"},{"location":"04-modelagem-dados/#stores_1","title":"<code>stores</code>","text":"Campo Tipo Obrigat\u00f3rio Regras / Observa\u00e7\u00f5es id int sim PK name string sim nome da loja city string sim cidade state string sim UF status string sim <code>PENDING</code> ou <code>ACTIVE</code> created_at datetime sim timestamp de cria\u00e7\u00e3o"},{"location":"04-modelagem-dados/#price_collections_1","title":"<code>price_collections</code>","text":"Campo Tipo Obrigat\u00f3rio Regras / Observa\u00e7\u00f5es id int sim PK store_id int sim FK \u2192 <code>stores.id</code> brand_id int sim FK \u2192 <code>brands.id</code> model_id int sim FK \u2192 <code>models.id</code> year_model int sim ano-modelo do ve\u00edculo price decimal sim pre\u00e7o coletado month_ref string sim <code>YYYY-MM</code> approval_status string sim <code>PENDING</code>, <code>APPROVED</code> ou <code>REJECTED</code> collected_at datetime sim data/hora de coleta approved_at datetime n\u00e3o preenchido quando aprovado"},{"location":"04-modelagem-dados/#monthly_averages_1","title":"<code>monthly_averages</code>","text":"Campo Tipo Obrigat\u00f3rio Regras / Observa\u00e7\u00f5es id int sim PK brand_id int sim FK \u2192 <code>brands.id</code> model_id int sim FK \u2192 <code>models.id</code> year_model int sim ano-modelo month_ref string sim <code>YYYY-MM</code> avg_price decimal sim m\u00e9dia consolidada median_price decimal n\u00e3o opcional (qualidade) std_dev decimal n\u00e3o opcional (qualidade) samples_count int sim quantidade de amostras consideradas created_at datetime sim timestamp de cria\u00e7\u00e3o"},{"location":"04-modelagem-dados/#query_logs_1","title":"<code>query_logs</code>","text":"Campo Tipo Obrigat\u00f3rio Regras / Observa\u00e7\u00f5es id int sim PK created_at datetime sim timestamp do evento brand_id int n\u00e3o filtro usado (se houver) model_id int n\u00e3o filtro usado (se houver) year_model int n\u00e3o filtro usado (se houver) month_ref string n\u00e3o <code>YYYY-MM</code> quando aplic\u00e1vel result_price decimal n\u00e3o preenchido quando <code>SUCCESS</code> status string sim <code>SUCCESS</code>, <code>NO_RESULT</code> ou <code>ERROR</code> error_message string n\u00e3o apenas se <code>ERROR</code>"},{"location":"04-modelagem-dados/#limites-e-proximos-passos","title":"Limites e pr\u00f3ximos passos","text":"<p>Fora do escopo (build) nesta vers\u00e3o: - CRUD de usu\u00e1rios e pap\u00e9is operacionais (Admin/Gerente/Coordenador/Pesquisador/Lojista) - fluxo de aprova\u00e7\u00e3o real em UI (ser\u00e1 simulado via seed/status)</p> <p>Pr\u00f3ximo artefato ligado ao modelo: - \u201cArquitetura (C4)\u201d mostrando onde o modelo vive (SQLAlchemy + Postgres) e os fluxos:   - Consulta p\u00fablica \u2192 <code>monthly_averages</code> + <code>query_logs</code>   - Batch mensal \u2192 <code>price_collections</code> \u2192 <code>monthly_averages</code></p>"},{"location":"05-arquitetura/","title":"Arquitetura do Sistema (C4 Model)","text":"<p>Esta se\u00e7\u00e3o descreve a arquitetura do CarFlow utilizando o modelo C4 (Context, Containers, Components). A documenta\u00e7\u00e3o parte do n\u00edvel macro (Contexto) at\u00e9 o n\u00edvel de organiza\u00e7\u00e3o de c\u00f3digo (Componentes), detalhando fronteiras, tecnologias e responsabilidades.</p>"},{"location":"05-arquitetura/#1-nivel-1-diagrama-de-contexto","title":"1. N\u00edvel 1: Diagrama de Contexto","text":"<p>Objetivo: Apresentar o sistema como uma \"caixa preta\" e suas intera\u00e7\u00f5es com os usu\u00e1rios.</p> <p></p>"},{"location":"05-arquitetura/#atores-e-sistemas","title":"Atores e Sistemas","text":"<ul> <li>Usu\u00e1rio P\u00fablico: Ator principal do escopo Build. Acessa o sistema via navegador para consultar pre\u00e7os consolidados. N\u00e3o requer autentica\u00e7\u00e3o.</li> <li>CarFlow System: O sistema em si. Respons\u00e1vel pela consolida\u00e7\u00e3o (Batch), armazenamento e exibi\u00e7\u00e3o dos dados de mercado.</li> <li>Equipe Operacional (Spec-only): Representa os perfis (Pesquisador, Coordenador) que alimentam a base. Nesta vers\u00e3o, suas intera\u00e7\u00f5es s\u00e3o documentadas para contexto, mas n\u00e3o implementadas no MVP.</li> </ul>"},{"location":"05-arquitetura/#2-nivel-2-diagrama-de-container","title":"2. N\u00edvel 2: Diagrama de Container","text":"<p>Objetivo: Abrir a \"caixa preta\" e mostrar as unidades de deploy (containers Docker) e tecnologias escolhidas.</p> <p></p>"},{"location":"05-arquitetura/#decisoes-de-arquitetura","title":"Decis\u00f5es de Arquitetura","text":"<ol> <li>Mon\u00f3lito Modular (Web App): Optou-se pelo Streamlit como container \u00fanico de aplica\u00e7\u00e3o. Ele atua simultaneamente como Frontend (UI) e Backend (Controller), simplificando a infraestrutura inicial sem perder capacidade de processamento.</li> <li>Segrega\u00e7\u00e3o de Processamento (Batch): O c\u00e1lculo de m\u00e9dias (pesado) foi isolado em um container/processo Batch separado.<ul> <li>Justificativa: Evitar que o processamento massivo de dados trave a navega\u00e7\u00e3o do usu\u00e1rio na interface web.</li> </ul> </li> <li>Persist\u00eancia Relacional (PostgreSQL): Escolhido pela robustez na integridade referencial (essencial para relacionar Marcas, Modelos e Coletas) e suporte a JSONB para logs.</li> </ol>"},{"location":"05-arquitetura/#3-nivel-3-diagrama-de-componentes","title":"3. N\u00edvel 3: Diagrama de Componentes","text":"<p>Objetivo: Detalhar a organiza\u00e7\u00e3o interna do Container \"Web App\" para orientar o desenvolvimento.</p> <p></p>"},{"location":"05-arquitetura/#estrutura-de-camadas","title":"Estrutura de Camadas","text":"<p>Para evitar o acoplamento excessivo, o c\u00f3digo do Streamlit foi estruturado em camadas l\u00f3gicas:</p> <ul> <li>Views (UI): Camada puramente visual. Renderiza widgets e captura eventos. N\u00e3o cont\u00e9m regras de neg\u00f3cio.</li> <li>Controller: Orquestra a requisi\u00e7\u00e3o. Valida inputs e chama o Servi\u00e7o adequado.</li> <li>Service Layer: O cora\u00e7\u00e3o da regra de neg\u00f3cio. Cont\u00e9m a l\u00f3gica de dom\u00ednio pura. Desconhece o Streamlit e o SQL.</li> <li>Repository Layer: Abstrai o acesso a dados. Garante que o dom\u00ednio n\u00e3o dependa de SQL direto.</li> </ul>"},{"location":"05-arquitetura/#4-infraestrutura-e-deploy","title":"4. Infraestrutura e Deploy","text":"<p>A aplica\u00e7\u00e3o opera em ambiente 100% nuvem (Cloud Native), utilizando servi\u00e7os PaaS (Platform as a Service) para reduzir a complexidade operacional (NoOps).</p> Componente Servi\u00e7o de Hospedagem Justificativa Web App Streamlit Community Cloud Integra\u00e7\u00e3o nativa com GitHub (CI/CD autom\u00e1tico) e gest\u00e3o de segredos. Database Render (PostgreSQL) Camada gratuita generosa, conex\u00e3o segura via SSL e facilidade de setup. <p>Fluxo de Deploy: 1.  Commit no branch <code>main</code> do GitHub. 2.  Streamlit Cloud detecta a mudan\u00e7a e reconstr\u00f3i o container da aplica\u00e7\u00e3o. 3.  A aplica\u00e7\u00e3o se conecta ao Render via vari\u00e1veis de ambiente (<code>DATABASE_URL</code>).</p>"},{"location":"06-technical-design/","title":"Technical Design (TD)","text":"<p>Esta se\u00e7\u00e3o detalha a arquitetura interna e as decis\u00f5es de implementa\u00e7\u00e3o do CarFlow. O documento serve como refer\u00eancia para o desenvolvimento, manuten\u00e7\u00e3o e evolu\u00e7\u00e3o do sistema, cobrindo camadas, fluxos de execu\u00e7\u00e3o, contratos de interface e requisitos n\u00e3o-funcionais.</p> <p>O foco deste documento \u00e9 o escopo Build (MVP):</p> <ul> <li>Consulta P\u00fablica: Interface de leitura de pre\u00e7os consolidados (sem login).</li> <li>Processamento Batch: Rotina mensal de consolida\u00e7\u00e3o de dados.</li> <li>Observabilidade: Registro t\u00e9cnico de logs de consulta para auditoria e an\u00e1lise.</li> </ul>"},{"location":"06-technical-design/#1-arquitetura-em-camadas","title":"1. Arquitetura em Camadas","text":"<p>O sistema segue uma arquitetura baseada em camadas (Layered Architecture) para garantir a separa\u00e7\u00e3o de responsabilidades e facilitar testes.</p> <p></p>"},{"location":"06-technical-design/#responsabilidades-dos-componentes","title":"Responsabilidades dos Componentes","text":"<ul> <li>Presentation Layer (Streamlit UI)</li> <li>Respons\u00e1vel pela renderiza\u00e7\u00e3o de filtros (widgets) e visualiza\u00e7\u00e3o de dados.</li> <li>Gerencia o estado da sess\u00e3o (Session State) e cache de interface.</li> <li>N\u00e3o cont\u00e9m regra de neg\u00f3cio: apenas valida entradas b\u00e1sicas e invoca o Service.</li> <li> <p>Trata os retornos do servi\u00e7o para exibir feedback visual (Success, Warning/No Result, Error).</p> </li> <li> <p>Service Layer (Business Logic)</p> </li> <li>N\u00facleo da aplica\u00e7\u00e3o. Implementa os casos de uso do sistema.</li> <li>Orquestra as chamadas ao reposit\u00f3rio e aplica regras de neg\u00f3cio (ex: c\u00e1lculo de varia\u00e7\u00e3o percentual, formata\u00e7\u00e3o de dados para gr\u00e1ficos).</li> <li> <p>Garante que todo acesso de consulta gere um registro de log (regra de auditoria).</p> </li> <li> <p>Repository Layer (Data Access)</p> </li> <li>Abstra\u00e7\u00e3o do banco de dados utilizando SQLAlchemy.</li> <li>Converte objetos de dom\u00ednio para queries SQL e vice-versa.</li> <li> <p>Isola a aplica\u00e7\u00e3o de detalhes espec\u00edficos do banco (PostgreSQL).</p> </li> <li> <p>Database (PostgreSQL)</p> </li> <li>Armazena os dados transacionais (<code>price_collections</code>), anal\u00edticos (<code>monthly_averages</code>) e logs (<code>query_logs</code>).</li> </ul>"},{"location":"06-technical-design/#2-fluxo-de-dados-e-dependencias","title":"2. Fluxo de Dados e Depend\u00eancias","text":"<p>O diagrama abaixo ilustra como os dados fluem entre o processo de carga (Batch) e o consumo (Consulta).</p> <p></p>"},{"location":"06-technical-design/#regras-de-integridade-do-fluxo","title":"Regras de Integridade do Fluxo","text":"<ol> <li>Segrega\u00e7\u00e3o de Leitura/Escrita: A consulta p\u00fablica acessa estritamente a tabela consolidada <code>monthly_averages</code>, garantindo performance e protegendo os dados brutos.</li> <li>Fonte do Batch: O processo de consolida\u00e7\u00e3o l\u00ea apenas registros com status <code>APPROVED</code> na tabela <code>price_collections</code>.</li> <li>Rastreabilidade: Toda intera\u00e7\u00e3o de consulta (inclusive falhas) persiste um evento imut\u00e1vel em <code>query_logs</code>.</li> </ol>"},{"location":"06-technical-design/#21-detalhamento-das-classes-code-design","title":"2.1. Detalhamento das Classes (Code Design)","text":"<p>O diagrama de classes abaixo ilustra a separa\u00e7\u00e3o estrita entre Regra de Neg\u00f3cio (Service) e Persist\u00eancia (Repository), seguindo o princ\u00edpio da Invers\u00e3o de Depend\u00eancia (DIP).</p> <p></p>"},{"location":"06-technical-design/#statisticsservice-domain-layer","title":"StatisticsService (Domain Layer)","text":"<p>Representa o \"c\u00e9rebro\" do processamento Batch. * Responsabilidade: Cont\u00e9m a l\u00f3gica matem\u00e1tica pura. N\u00e3o sabe que existe um banco de dados, nem que existe uma interface web. * M\u00e9todos Chave:     * <code>calculate_mean(data: List[float]) -&gt; Decimal</code>: Recebe uma lista de pre\u00e7os brutos e devolve a m\u00e9dia ponderada.     * <code>remove_outliers(data)</code>: Implementa o algoritmo IQR (Intervalo Interquartil) para expurgar pre\u00e7os irreais (ex: R$ 10,00 ou R$ 1.000.000,00 para um Gol).     * <code>consolidate_month(ref_date)</code>: Orquestra o processo: chama o reposit\u00f3rio para buscar dados, limpa, calcula e manda salvar.</p>"},{"location":"06-technical-design/#irepository-interface-contract","title":"IRepository (Interface / Contract)","text":"<p>Define o contrato de acesso aos dados. * Responsabilidade: Garantir que a camada de servi\u00e7o n\u00e3o dependa de uma implementa\u00e7\u00e3o espec\u00edfica de banco (PostgreSQL). * Por que usar: Permite criar um <code>FakeRepository</code> (em mem\u00f3ria) para rodar testes unit\u00e1rios ultra-r\u00e1pidos sem precisar subir um container Docker de banco de dados.</p>"},{"location":"06-technical-design/#postgresrepository-infrastructure-layer","title":"PostgresRepository (Infrastructure Layer)","text":"<p>A implementa\u00e7\u00e3o real do contrato. * Responsabilidade: Traduzir as chamadas do Service para dialeto SQL usando SQLAlchemy. * M\u00e9todos Chave:     * <code>get_by_filters(...)</code>: Monta queries din\u00e2micas baseadas nos filtros da tela.     * <code>save_bulk(...)</code>: Utiliza opera\u00e7\u00f5es de batch insert para salvar milhares de m\u00e9dias de uma vez, garantindo performance.</p>"},{"location":"06-technical-design/#monthlyaverage-data-model","title":"MonthlyAverage (Data Model)","text":"<p>Representa a estrutura de dados da tabela consolidada. * Responsabilidade: Mapeamento Objeto-Relacional (ORM). * Atributos: \u00c9 uma classe \"an\u00eamica\" (focada em dados), contendo <code>brand_id</code>, <code>model_id</code>, <code>avg_price</code> e <code>month_ref</code>.</p>"},{"location":"06-technical-design/#22-decisao-de-design-repository-pattern","title":"2.2. Decis\u00e3o de Design: Repository Pattern","text":"<p>Adotamos o padr\u00e3o Repository para isolar a complexidade do SQLAlchemy.</p> <p>Sem Repository (Anti-pattern no Service): <pre><code># Ruim: O Service sabe que existe SQL e Sess\u00e3o\ndef calcular_media():\n    dados = db.execute(\"SELECT * FROM table\") # Acoplado ao SQL\n    # ...calcula...\n    db.commit()\n</code></pre></p> <p>Com Repository (Nossa Abordagem):</p> <pre><code># Bom: O Service s\u00f3 fala \"Python\"\ndef calcular_media(repo: IRepository):\n    dados = repo.fetch_all() # Abstra\u00e7\u00e3o\n    # ...calcula...\n    repo.save(resultado)\n</code></pre> <p>Isso garante que, se mudarmos o banco para MongoDB ou CSV no futuro, a l\u00f3gica de c\u00e1lculo de m\u00e9dia (Service) n\u00e3o precisa ser alterada, apenas a implementa\u00e7\u00e3o do Reposit\u00f3rio.</p>"},{"location":"06-technical-design/#3-detalhamento-caso-de-uso-consulta-publica","title":"3. Detalhamento: Caso de Uso \"Consulta P\u00fablica\"","text":""},{"location":"06-technical-design/#fluxo-de-sequencia","title":"Fluxo de Sequ\u00eancia","text":""},{"location":"06-technical-design/#contrato-da-interface-service-layer","title":"Contrato da Interface (Service Layer)","text":"<p>Entrada (DTO/Argumentos):</p> <ul> <li><code>brand_id</code> (int, obrigat\u00f3rio)</li> <li><code>model_id</code> (int, obrigat\u00f3rio)</li> <li><code>year_model</code> (int, obrigat\u00f3rio)</li> </ul> <p>Sa\u00edda (Response Object):</p> <ul> <li>Cen\u00e1rio SUCCESS: Objeto contendo <code>avg_price</code> (Decimal), <code>month_ref</code> (Date) e <code>samples_count</code> (Int).</li> <li>Cen\u00e1rio NO_RESULT: Retorno vazio ou <code>None</code> (interpretado pela UI como \"Sem dados para este per\u00edodo\").</li> <li>Cen\u00e1rio ERROR: Exce\u00e7\u00e3o tratada ou objeto de erro contendo mensagem amig\u00e1vel (sem expor stacktrace).</li> </ul>"},{"location":"06-technical-design/#comportamento-e-tratamento-de-erros","title":"Comportamento e Tratamento de Erros","text":"<ul> <li>Resili\u00eancia: Falhas de conex\u00e3o com o banco s\u00e3o capturadas no Reposit\u00f3rio e relan\u00e7adas como exce\u00e7\u00f5es de dom\u00ednio (<code>DatabaseConnectionError</code>), permitindo que a UI exiba uma mensagem de \"Servi\u00e7o Indispon\u00edvel\" em vez de quebrar.</li> <li>Log de Auditoria: O registro em <code>query_logs</code> ocorre em um bloco <code>finally</code> ou via hook ass\u00edncrono para garantir que seja gravado independente do sucesso da busca.</li> </ul>"},{"location":"06-technical-design/#4-detalhamento-caso-de-uso-batch-mensal-etl","title":"4. Detalhamento: Caso de Uso \"Batch Mensal\" (ETL)","text":""},{"location":"06-technical-design/#fluxo-de-sequencia_1","title":"Fluxo de Sequ\u00eancia","text":""},{"location":"06-technical-design/#estrategia-de-processamento-etl","title":"Estrat\u00e9gia de Processamento (ETL)","text":"<p>O Batch atua como um processo de ETL (Extract, Transform, Load) executado sob demanda ou agendamento.</p> <ol> <li>Extract: Busca coletas em <code>price_collections</code> onde <code>status='APPROVED'</code> e <code>month_ref</code> corresponde ao per\u00edodo alvo.</li> <li>Transform:</li> <li>Agrupamento por <code>(brand_id, model_id, year_model)</code>.</li> <li>C\u00e1lculo de estat\u00edsticas: M\u00e9dia (<code>avg</code>), Contagem (<code>count</code>).</li> <li> <p>(Futuro): Remo\u00e7\u00e3o de outliers via desvio padr\u00e3o ou IQR.</p> </li> <li> <p>Load: Persist\u00eancia na tabela <code>monthly_averages</code>.</p> </li> </ol>"},{"location":"06-technical-design/#idempotencia-e-consistencia","title":"Idempot\u00eancia e Consist\u00eancia","text":"<ul> <li>O script utiliza a estrat\u00e9gia de UPSERT (Insert on Conflict Update) baseada na chave \u00fanica composta <code>(model_id, year_model, month_ref)</code>.</li> <li>Isso permite que o batch seja reexecutado m\u00faltiplas vezes para o mesmo m\u00eas sem duplicar dados, apenas atualizando os valores consolidados.</li> </ul>"},{"location":"06-technical-design/#5-decisoes-tecnicas-e-trade-offs","title":"5. Decis\u00f5es T\u00e9cnicas e Trade-offs","text":""},{"location":"06-technical-design/#51-denormalizacao-controlada","title":"5.1. Denormaliza\u00e7\u00e3o Controlada","text":"<p>Embora o modelo relacional seja normalizado, as tabelas de neg\u00f3cio (<code>monthly_averages</code>, <code>query_logs</code>) armazenam redund\u00e2ncias controladas, como <code>brand_id</code> junto ao <code>model_id</code>.</p> <ul> <li>Motiva\u00e7\u00e3o: Eliminar a necessidade de JOINs complexos nas consultas de leitura cr\u00edtica (Dashboard P\u00fablico), otimizando a performance.</li> <li>Garantia: A integridade \u00e9 assegurada pelo processo de ingest\u00e3o (Batch) e pelas Foreign Keys.</li> </ul>"},{"location":"06-technical-design/#52-stack-tecnologica","title":"5.2. Stack Tecnol\u00f3gica","text":"<ul> <li>Linguagem: Python 3.10+ (Tipagem est\u00e1tica com Pydantic/Type Hints).</li> <li>ORM: SQLAlchemy 2.0 (Gerenciamento de sess\u00f5es e prote\u00e7\u00e3o contra SQL Injection).</li> <li>UI: Streamlit (Desenvolvimento r\u00e1pido de interfaces de dados).</li> </ul>"},{"location":"06-technical-design/#6-estrutura-do-projeto-source-code","title":"6. Estrutura do Projeto (Source Code)","text":"<p>A organiza\u00e7\u00e3o do c\u00f3digo fonte reflete a arquitetura em camadas descrita acima, simplificada para o contexto do Streamlit:</p> <pre><code>src/\n\u251c\u2500\u2500 batch_etl.py        # Script do Processo Batch (ETL)\n\u251c\u2500\u2500 database.py         # Configura\u00e7\u00e3o de conex\u00e3o DB e Session\n\u251c\u2500\u2500 main.py             # Entrypoint da Aplica\u00e7\u00e3o (View + Controller)\n\u251c\u2500\u2500 models.py           # Todos os Modelos ORM (Entities)\n\u251c\u2500\u2500 repositories.py     # Camada de Acesso a Dados (Repository Pattern)\n\u251c\u2500\u2500 seed_data.py        # Script para popular banco com dados fict\u00edcios\n\u2514\u2500\u2500 services.py         # Regras de Neg\u00f3cio (Service Layer)\n</code></pre>"},{"location":"06-technical-design/#7-requisitos-nao-funcionais","title":"7. Requisitos N\u00e3o-Funcionais","text":""},{"location":"06-technical-design/#performance","title":"Performance","text":"<ul> <li>Indexa\u00e7\u00e3o: \u00cdndices criados nas colunas de filtro (<code>brand_id</code>, <code>model_id</code>, <code>year</code>) nas tabelas de leitura.</li> <li>Cache: Utiliza\u00e7\u00e3o do <code>@st.cache_data</code> do Streamlit para armazenar listas est\u00e1ticas (Marcas/Modelos), reduzindo chamadas ao banco.</li> </ul>"},{"location":"06-technical-design/#seguranca","title":"Seguran\u00e7a","text":"<ul> <li>Acesso: Consulta p\u00fablica restrita a dados agregados; dados brutos (que poderiam identificar lojas ou vendedores) n\u00e3o s\u00e3o expostos na UI p\u00fablica.</li> <li>Privacidade: O <code>query_logs</code> n\u00e3o armazena PII (Informa\u00e7\u00e3o Pessoal Identific\u00e1vel) do usu\u00e1rio da consulta, limitando-se a metadados da requisi\u00e7\u00e3o.</li> </ul>"},{"location":"07-qualidade/","title":"Estrat\u00e9gia de Qualidade (QA)","text":"<p>A garantia de qualidade do CarFlow baseia-se em tr\u00eas pilares: An\u00e1lise Est\u00e1tica, Testes Automatizados com alta cobertura e Integra\u00e7\u00e3o Cont\u00ednua (CI). O objetivo \u00e9 garantir que as regras de neg\u00f3cio e o processamento de dados (ETL) permane\u00e7am est\u00e1veis a cada evolu\u00e7\u00e3o.</p>"},{"location":"07-qualidade/#1-ferramentas-utilizadas","title":"1. Ferramentas Utilizadas","text":"Ferramenta Tipo Fun\u00e7\u00e3o Ruff Linter / Formatter Analisa o c\u00f3digo estaticamente em busca de erros de sintaxe e viola\u00e7\u00f5es de estilo (PEP 8). Pytest Framework de Teste Execu\u00e7\u00e3o de testes unit\u00e1rios e de integra\u00e7\u00e3o. Coverage.py An\u00e1lise de Cobertura Mede qual porcentagem do c\u00f3digo fonte foi executada durante os testes. GitHub Actions CI Server Orquestrador que executa o pipeline a cada Push ou Pull Request."},{"location":"07-qualidade/#2-pipeline-de-integracao-continua-ci","title":"2. Pipeline de Integra\u00e7\u00e3o Cont\u00ednua (CI)","text":"<p>O fluxo de CI est\u00e1 definido no arquivo <code>.github/workflows/ci.yml</code>.</p>"},{"location":"07-qualidade/#estagios-do-pipeline","title":"Est\u00e1gios do Pipeline:","text":"<ol> <li>Trigger: Acionado em qualquer <code>push</code> ou <code>pull_request</code> para a <code>main</code>.</li> <li>Setup: Provisiona uma m\u00e1quina virtual Ubuntu e instala Python 3.11.</li> <li>Depend\u00eancias: Instala as bibliotecas do <code>requirements.txt</code>.</li> <li>Linting (Gatekeeper): Executa o <code>ruff check .</code>. Se houver c\u00f3digo fora do padr\u00e3o, o pipeline falha.</li> <li>Testes &amp; Cobertura: Executa o <code>pytest</code> validando a l\u00f3gica e garantindo a integridade dos dados.</li> </ol>"},{"location":"07-qualidade/#3-metricas-de-cobertura-code-coverage","title":"3. M\u00e9tricas de Cobertura (Code Coverage)","text":"<p>O projeto mant\u00e9m um padr\u00e3o rigoroso de qualidade, atingindo atualmente 96% de cobertura de c\u00f3digo.</p> <p>Isso significa que quase a totalidade das linhas de c\u00f3digo l\u00f3gicas (Services, ETL, Repositories e Utils) s\u00e3o validadas a cada deploy.</p> <p>Foi monitorado cobertura de c\u00f3digo para garantir que caminhos cr\u00edticos n\u00e3o fiquem desprotegidos.</p> Componente Meta de Cobertura Cr\u00edtico? Services (L\u00f3gica) &gt; 90% Sim Repositories (SQL) &gt; 80% Sim Models (ORM) &gt; 95% N\u00e3o (declarativo) UI (Streamlit) &gt; 50% N\u00e3o (Smoke test) <p> </p>"},{"location":"07-qualidade/#4-cenarios-de-teste-principais","title":"4. Cen\u00e1rios de Teste Principais","text":"<p>A su\u00edte de testes automatizados foca nas \u00e1reas cr\u00edticas do sistema:</p> <ol> <li>C\u00e1lculo de M\u00e9dias (ETL):<ul> <li>Verificar se o agrupamento de pre\u00e7os ignora corretamente dados nulos.</li> <li>Garantir que a m\u00e9dia ponderada considera os volumes corretos.</li> </ul> </li> <li>Resili\u00eancia de Dados:<ul> <li>Idempot\u00eancia: Rodar o Batch duas vezes seguidas n\u00e3o deve duplicar registros na tabela <code>monthly_averages</code>.</li> </ul> </li> <li>Conectividade e Falhas:<ul> <li>Simular queda de banco de dados (Mock) para garantir que o sistema exibe mensagens de erro amig\u00e1veis em vez de travar (Crash).</li> </ul> </li> </ol>"},{"location":"08-adr/","title":"Architectural Decision Records (ADR)","text":"<p>Este documento registra as decis\u00f5es de arquitetura significativas, seu contexto e consequ\u00eancias. Serve como mem\u00f3ria t\u00e9cnica do projeto CarFlow.</p>"},{"location":"08-adr/#adr-001-uso-do-streamlit-como-monolito-modular","title":"ADR-001: Uso do Streamlit como Mon\u00f3lito Modular","text":"<ul> <li>Status: Aceito</li> <li>Data: 2024-02-01</li> <li>Contexto:     Interface web r\u00e1pida para o MVP (Build), sem a complexidade de manter um Frontend (React/Vue) e um Backend (FastAPI/Django) separados neste momento.</li> <li>Decis\u00e3o:     Utilizar o Streamlit como stack \u00fanica.</li> <li>Consequ\u00eancias:<ul> <li>(+) Desenvolvimento extremamente r\u00e1pido (Python-only).</li> <li>(+) Deploy simplificado (apenas 1 container Docker).</li> <li>(-) Acoplamento entre UI e l\u00f3gica se n\u00e3o houver disciplina (mitigado pela ADR-002).</li> <li>(-) Menor flexibilidade visual comparado a HTML/CSS puro.</li> </ul> </li> </ul>"},{"location":"08-adr/#adr-002-repository-pattern-com-sqlalchemy","title":"ADR-002: Repository Pattern com SQLAlchemy","text":"<ul> <li>Status: Aceito</li> <li>Data: 2024-02-03</li> <li>Contexto:     Necessidade de isolar a tecnologia de banco de dados e facilitar testes unit\u00e1rios com mocking.</li> <li>Decis\u00e3o:     Implementar o padr\u00e3o Repository para abstrair todas as chamadas <code>session.query()</code>, <code>session.add()</code>, etc. O Service nunca chama o SQLAlchemy diretamente.</li> <li>Consequ\u00eancias:<ul> <li>(+) Testes de services n\u00e3o precisam de banco de dados real (usamos <code>FakeRepository</code>).</li> <li>(+) Consultas ficam centralizadas e reutiliz\u00e1veis.</li> <li>(-) Curva de aprendizado e verbosidade inicial.</li> </ul> </li> </ul>"},{"location":"08-adr/#adr-003-processamento-batch-sincrono-mvp","title":"ADR-003: Processamento Batch S\u00edncrono (MVP)","text":"<ul> <li>Status: Aceito (Provis\u00f3rio)</li> <li>Data: 2024-02-05</li> <li>Contexto:     O c\u00e1lculo de m\u00e9dias mensais \u00e9 pesado, mas no MVP o volume de dados \u00e9 controlado (milhares de linhas, n\u00e3o milh\u00f5es). Arquiteturas de filas (RabbitMQ/Kafka) adicionariam complexidade infraestrutural desnecess\u00e1ria agora.</li> <li>Decis\u00e3o:     Executar o ETL Batch como um script Python simples (<code>src/batch_etl.py</code>) acionado sob demanda ou cronjob.</li> <li>Consequ\u00eancias:<ul> <li>(+) Infraestrutura leve (apenas Postgres e App).</li> <li>(-) Se o volume explodir, o processo pode sofrer timeout ou travar o banco.</li> <li>() Mitiga\u00e7\u00e3o:* Processamento \u00e9 feito em transa\u00e7\u00f5es e o script roda separado do processo web.</li> </ul> </li> </ul>"},{"location":"08-adr/#adr-004-denormalizacao-controlada-monthly_averages","title":"ADR-004: Denormaliza\u00e7\u00e3o Controlada (<code>monthly_averages</code>)","text":"<ul> <li>Status: Aceito</li> <li>Data: 2024-02-06</li> <li>Contexto:     A consulta p\u00fablica precisa ser instant\u00e2nea. Fazer <code>JOINs</code> entre <code>price_collections</code>, <code>brands</code>, <code>models</code> e calcular <code>AVG()</code> em tempo real a cada clique seria invi\u00e1vel em escala.</li> <li>Decis\u00e3o:     Criar uma tabela consolidada (<code>monthly_averages</code>) que j\u00e1 cont\u00e9m os dados prontos para leitura, incluindo redund\u00e2ncia de IDs (<code>brand_id</code>, <code>model_id</code>) para evitar JOINs complexos na leitura.</li> <li>Consequ\u00eancias:<ul> <li>(+) Leitura ultra-r\u00e1pida (SELECT simples por \u00edndice).</li> <li>(-) Necessidade de manter consist\u00eancia (o Batch \u00e9 respons\u00e1vel por isso).</li> </ul> </li> </ul>"},{"location":"08-adr/#adr-005-render-free-tier-para-banco-de-dados","title":"ADR 005: Render Free Tier para Banco de Dados","text":"<ul> <li>Status: Aceito</li> <li>Contexto: Projeto de portf\u00f3lio sem or\u00e7amento para infraestrutura, necessitando de acesso p\u00fablico.</li> <li>Decis\u00e3o: Utilizar o plano gratuito do Render.com para o PostgreSQL.</li> <li>Consequ\u00eancias:<ul> <li>(+) Custo zero.</li> <li>(+) Acesso externo f\u00e1cil.</li> <li>(-) Cold Start: O banco \"hiberna\" ap\u00f3s inatividade, causando lat\u00eancia de ~30s na primeira conex\u00e3o (tratado via UX com spinners).</li> </ul> </li> </ul>"},{"location":"08-adr/#adr-006-linter-ruff","title":"ADR 006: Linter Ruff","text":"<ul> <li>Status: Aceito</li> <li>Contexto: Necessidade de manter o c\u00f3digo limpo e padronizado no CI/CD.</li> <li>Decis\u00e3o: Substituir o conjunto tradicional (Flake8 + Isort + Black) pelo Ruff.</li> <li>Consequ\u00eancias:<ul> <li>(+) Execu\u00e7\u00e3o extremamente r\u00e1pida no pipeline de CI.</li> <li>(+) Configura\u00e7\u00e3o centralizada.</li> </ul> </li> </ul>"},{"location":"09-jira/","title":"Jira &amp; Planning","text":"<p>Esta se\u00e7\u00e3o documenta como o projeto CarFlow foi planejado e organizado no Jira, incluindo: - estrutura de \u00e9picos (macro-entregas), - padr\u00e3o de issues (hist\u00f3rias e tarefas), - uso de labels (build vs spec-only), - workflow (A fazer \u2192 Em progresso \u2192 Feito), - defini\u00e7\u00e3o de pronto (DoD) e rastreabilidade com a documenta\u00e7\u00e3o.</p>"},{"location":"09-jira/#visao-geral-do-projeto-no-jira","title":"Vis\u00e3o geral do projeto no Jira","text":"<p>O planejamento foi estruturado para um projeto individual, com foco em: - manter escopo controlado (build), - documentar o que \u00e9 apenas especifica\u00e7\u00e3o (spec-only), - permitir evolu\u00e7\u00e3o incremental com entregas pequenas e claras.</p> <p></p> \ud83d\udccc Jira (Planning) <ul> <li>Acompanhe o board, \u00e9picos, labels e progresso do projeto.</li> </ul>  Abrir Jira"},{"location":"09-jira/#estrutura-de-epicos","title":"Estrutura de \u00c9picos","text":"<p>Os \u00e9picos representam \u201cpacotes\u201d de entrega:</p> <ul> <li>Engenharia de Requisitos &amp; Design</li> <li>Arquitetura &amp; Modelagem de Dados</li> <li>Infraestrutura &amp; Backend (Core)</li> <li>Frontend &amp; Experi\u00eancia do Usu\u00e1rio</li> <li>Qualidade &amp; Entrega</li> </ul>"},{"location":"09-jira/#tipos-de-issues-padrao","title":"Tipos de Issues (padr\u00e3o)","text":""},{"location":"09-jira/#historia-user-story","title":"Hist\u00f3ria (User Story)","text":"<p>Usada para requisitos de valor (ex.: consulta p\u00fablica, batch mensal). Campos m\u00ednimos recomendados: - Como [ator], eu quero [a\u00e7\u00e3o], para [valor] - Crit\u00e9rios de aceite - Labels: <code>build</code> ou <code>spec-only</code></p>"},{"location":"09-jira/#tarefa","title":"Tarefa","text":"<p>Usada para atividades t\u00e9cnicas/documentais (ex.: diagrama, ERD, pipeline, testes). Exemplo de tarefa: testes da l\u00f3gica de m\u00e9dia no batch. :contentReference[oaicite:1]{index=1}</p>"},{"location":"09-jira/#labels-padrao-do-projeto","title":"Labels (padr\u00e3o do projeto)","text":"<p>Para deixar o projeto \u201caudit\u00e1vel\u201d e claro:</p> <ul> <li><code>build</code> \u2192 ser\u00e1 implementado</li> <li><code>spec-only</code> \u2192 apenas documenta\u00e7\u00e3o / wireframe / diagrama</li> <li><code>docs</code> \u2192 item ligado ao MkDocs</li> <li><code>diagram</code> \u2192 item que gera artefato visual (BPMN/ERD/C4/Sequ\u00eancia)</li> <li><code>batch</code> \u2192 consolida\u00e7\u00e3o mensal</li> <li><code>db</code> \u2192 modelagem/migra\u00e7\u00e3o/SQLAlchemy/Postgres</li> <li><code>ui</code> \u2192 Streamlit</li> </ul> <p>No export do Jira aparecem labels como <code>diagram, docs, spec-only</code>. :contentReference[oaicite:2]{index=2}</p>"},{"location":"09-jira/#workflow-kanban","title":"Workflow (Kanban)","text":"<p>Colunas sugeridas (simples e eficiente para projeto individual): 1. A fazer 2. Em progresso 3. Feito</p> <p>Regras pr\u00e1ticas: - S\u00f3 pode ter 1\u20132 cards em \u201cEm progresso\u201d ao mesmo tempo (WIP). - Tarefas grandes devem ser quebradas (ex.: \u201cArquitetura C4\u201d vira Contexto / Containers / Componentes).</p>"},{"location":"09-jira/#definition-of-done-dod","title":"Definition of Done (DoD)","text":"<p>Uma issue s\u00f3 vai para Feito quando:</p>"},{"location":"09-jira/#para-docs-diagram","title":"Para <code>docs</code> / <code>diagram</code>","text":"<ul> <li>Arquivo <code>.md</code> criado/atualizado no MkDocs</li> <li>Imagem exportada em <code>docs/assets/diagrams/</code></li> <li>Link no texto do MkDocs apontando para a imagem (com glightbox, quando aplic\u00e1vel)</li> </ul>"},{"location":"09-jira/#para-build","title":"Para <code>build</code>","text":"<ul> <li>C\u00f3digo implementado</li> <li>Teste m\u00ednimo (unit\u00e1rio ou valida\u00e7\u00e3o execut\u00e1vel)</li> <li>Rodou local via <code>docker compose up</code> (quando for infra/backend)</li> <li>Documenta\u00e7\u00e3o \u201cComo rodar\u201d atualizada</li> </ul>"},{"location":"10-prototipos/","title":"Prot\u00f3tipos de Interface (UI/UX)","text":"<p>Esta se\u00e7\u00e3o apresenta os wireframes de alta fidelidade para todos os atores identificados nos requisitos. O objetivo \u00e9 validar a usabilidade e garantir que cada papel tenha sua interface definida.</p> <p>O projeto adota uma estrat\u00e9gia de Interface Unificada (Streamlit): todas as telas s\u00e3o web, acess\u00edveis via navegador, com layouts responsivos adaptados \u00e0 fun\u00e7\u00e3o.</p>"},{"location":"10-prototipos/#1-modulo-publico-acesso-livre","title":"1. M\u00f3dulo P\u00fablico (Acesso Livre)","text":""},{"location":"10-prototipos/#11-consulta-de-precos-usuario-publico","title":"1.1. Consulta de Pre\u00e7os (Usu\u00e1rio P\u00fablico)","text":"<p>Status: Build (Implementado) A interface principal do produto. Design \"buscou, achou\", focada na entrega r\u00e1pida do valor consolidado.</p> <ul> <li>Filtros: Marca \u2192 Modelo \u2192 Ano (Cascata).</li> <li>Visualiza\u00e7\u00e3o: KPIs de pre\u00e7o e gr\u00e1fico de tend\u00eancia hist\u00f3rica.</li> </ul> <p></p>"},{"location":"10-prototipos/#12-cadastro-de-parceiro-lojista","title":"1.2. Cadastro de Parceiro (Lojista)","text":"<p>Status: Spec-only Tela de \"Landing Page\" onde um lojista pode solicitar seu credenciamento para receber visitas.</p> <ul> <li>Funcionalidade: Formul\u00e1rio de auto-cadastro (Nome da Loja, CNPJ, Endere\u00e7o).</li> <li>Fluxo: Ao enviar, gera uma pend\u00eancia para aprova\u00e7\u00e3o do Coordenador Regional.</li> </ul> <p></p>"},{"location":"10-prototipos/#2-modulo-operacional-campo-tatico","title":"2. M\u00f3dulo Operacional (Campo &amp; T\u00e1tico)","text":""},{"location":"10-prototipos/#21-coleta-mobile-pesquisador","title":"2.1. Coleta Mobile (Pesquisador)","text":"<p>Status: Spec-only Interface web responsiva (formato smartphone) para digita\u00e7\u00e3o \u00e1gil dentro das lojas.</p> <ul> <li>UX: Campos grandes, input num\u00e9rico otimizado e upload opcional de fotos.</li> </ul> <p></p>"},{"location":"10-prototipos/#_1","title":"Prot\u00f3tipos","text":""},{"location":"10-prototipos/#22-rotinas-e-scripts-auxiliares","title":"2.2. Rotinas e Scripts Auxiliares","text":"<p>Como esse papel n\u00e3o ser\u00e1 implementado, foi feito dois scripts python para auxiliar no desenvolvimento da UI.</p>"},{"location":"10-prototipos/#carga-inicial-seed-data","title":"Carga Inicial (Seed Data)","text":"<ul> <li>Fun\u00e7\u00e3o: <code>src/seed_data.py</code></li> <li>L\u00f3gica: Gera milhares de registros de <code>price_collections</code> distribu\u00eddos nos \u00faltimos 13 meses, simulando varia\u00e7\u00f5es de pre\u00e7o por regi\u00e3o e deprecia\u00e7\u00e3o temporal.</li> <li>Uso: Essencial para evitar que a aplica\u00e7\u00e3o inicie \"vazia\" em novos ambientes.</li> </ul>"},{"location":"10-prototipos/#script-batch-etl","title":"Script Batch (ETL)","text":"<ul> <li>Fun\u00e7\u00e3o: <code>src/batch_etl.py</code></li> <li>L\u00f3gica:<ol> <li>Extract: Busca coletas brutas no banco.</li> <li>Transform: Agrupa por Marca/Modelo/Ano/Regi\u00e3o e calcula a m\u00e9dia ponderada.</li> <li>Load: Insere ou atualiza (Upsert) a tabela <code>monthly_averages</code> (otimizada para leitura).</li> </ol> </li> <li>Execu\u00e7\u00e3o: Projetado para rodar mensalmente ou sob demanda.</li> </ul>"},{"location":"10-prototipos/#22-gestao-regional-coordenador","title":"2.2. Gest\u00e3o Regional (Coordenador)","text":"<p>Status: Spec-only Dashboard para controle de qualidade e gest\u00e3o da equipe local.</p> <ul> <li>Valida\u00e7\u00e3o: Tabela para aprovar/rejeitar coletas (destaque para outliers).</li> <li>Roteiros: (Futuro) Interface para definir quais lojas os pesquisadores visitar\u00e3o.</li> </ul> <p></p>"},{"location":"10-prototipos/#3-modulo-administrativo-backoffice","title":"3. M\u00f3dulo Administrativo (Backoffice)","text":""},{"location":"10-prototipos/#31-gestao-de-catalogo-gerente","title":"3.1. Gest\u00e3o de Cat\u00e1logo (Gerente)","text":"<p>Status: Spec-only Respons\u00e1vel pela padroniza\u00e7\u00e3o dos dados. \u00c9 aqui que se evita duplicidade (ex: \"Fiat\" vs \"FIAT\").</p> <ul> <li>A\u00e7\u00e3o: Cadastro de novas Marcas e Modelos que aparecer\u00e3o na busca p\u00fablica.</li> </ul> <p></p>"},{"location":"10-prototipos/#32-controle-de-acesso-administrador","title":"3.2. Controle de Acesso (Administrador)","text":"<p>Status: Spec-only Interface t\u00e9cnica para gest\u00e3o de usu\u00e1rios do sistema.</p> <ul> <li>A\u00e7\u00e3o: Criar contas para Gerentes, Coordenadores e Pesquisadores, definindo seus perfis (RBAC).</li> </ul> <p></p>"}]}